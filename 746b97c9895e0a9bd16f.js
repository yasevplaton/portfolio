(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{383:function(t,r,e){"use strict";e.d(r,"a",function(){return o});var o="https://webdev-api.loftschool.com"},393:function(t,r,e){},416:function(t,r,e){"use strict";var o=e(393);e.n(o).a},442:function(t,r,e){"use strict";e.r(r);var o=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"form-block"},[e("h2",{staticClass:"form-block__title"},[t._v("Редактирование работы")]),e("form",{staticClass:"form work-form form-block__content form-block__content--work"},[e("div",{staticClass:"form__photo form__photo--work"},[e("label",{staticClass:"form__upload-photo-wrapper"},[e("div",{staticClass:"form__upload-photo-container",class:{filled:this.renderedPhotoUrl.length,error:t.validation.firstError("renderedPhotoUrl")},style:{backgroundImage:"url("+this.renderedPhotoUrl+")"}},[e("input",{staticClass:"form__upload-photo-input",attrs:{type:"file"},on:{change:t.appendFileAndRenderPhoto}}),e("div",{staticClass:"form__upload-photo-error"},[e("error-tooltip",{attrs:{errorText:t.validation.firstError("renderedPhotoUrl")}})],1),t._m(0)])])]),e("div",{staticClass:"form__text form__text--work"},[e("div",{staticClass:"form__row"},[e("div",{staticClass:"form__col"},[e("label",{staticClass:"form__text-block",class:{error:t.validation.firstError("work.title")},attrs:{for:"title"}},[e("span",{staticClass:"form__label"},[t._v("Название")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.work.title,expression:"work.title"}],staticClass:"form__input form__input--title",attrs:{id:"title",type:"text",name:"title",placeholder:"Введите название работы"},domProps:{value:t.work.title},on:{input:function(r){r.target.composing||t.$set(t.work,"title",r.target.value)}}}),e("div",{staticClass:"form__text-block-error"},[e("error-tooltip",{attrs:{errorText:t.validation.firstError("work.title")}})],1)])])]),e("div",{staticClass:"form__row"},[e("div",{staticClass:"form__col"},[e("label",{staticClass:"form__text-block",class:{error:t.validation.firstError("work.link")},attrs:{for:"link"}},[e("span",{staticClass:"form__label"},[t._v("Ссылка")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.work.link,expression:"work.link"}],staticClass:"form__input form__input--link",attrs:{id:"link",type:"text",name:"link",placeholder:"Вставьте ссылку"},domProps:{value:t.work.link},on:{input:function(r){r.target.composing||t.$set(t.work,"link",r.target.value)}}}),e("div",{staticClass:"form__text-block-error"},[e("error-tooltip",{attrs:{errorText:t.validation.firstError("work.link")}})],1)])])]),e("div",{staticClass:"form__row form__row--textarea"},[e("div",{staticClass:"form__col"},[e("label",{staticClass:"form__text-block form__text-block--textarea",class:{error:t.validation.firstError("work.description")},attrs:{for:"description"}},[e("span",{staticClass:"form__label"},[t._v("Описание")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.work.description,expression:"work.description"}],staticClass:"form__textarea",attrs:{id:"description",name:"description",rows:"4",placeholder:"Введите описание работы"},domProps:{value:t.work.description},on:{input:function(r){r.target.composing||t.$set(t.work,"description",r.target.value)}}}),e("div",{staticClass:"form__text-block-error"},[e("error-tooltip",{attrs:{errorText:t.validation.firstError("work.description")}})],1)])])]),e("div",{staticClass:"form__row form__row--tags"},[e("div",{staticClass:"form__col"},[e("label",{staticClass:"form__text-block",class:{error:t.validation.firstError("editedTagsAsString")},attrs:{for:"tags"}},[e("span",{staticClass:"form__label"},[t._v("Добавление тега")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.work.techs,expression:"work.techs"}],staticClass:"form__input form__input--tags",attrs:{id:"tags",type:"text",name:"tags",placeholder:"Если хотите, добавьте теги"},domProps:{value:t.work.techs},on:{change:function(r){return t.ADD_TAGS(t.work.techs)},input:function(r){r.target.composing||t.$set(t.work,"techs",r.target.value)}}}),e("div",{staticClass:"form__text-block-error"},[e("error-tooltip",{attrs:{errorText:t.validation.firstError("editedTagsAsString")}})],1)])])]),e("div",{staticClass:"form__row"},[t.workForm.editMode?e("div",{staticClass:"form__col"},[e("form-tags")],1):t._e()]),e("div",{staticClass:"form__row form__row--btns"},[e("div",{staticClass:"form__col"},[e("div",{staticClass:"form__btns"},[e("button",{staticClass:"btn btn--cancel-edit",attrs:{type:"button"},on:{click:t.CLOSE_FORM}},[t._v("Отмена")]),t.workForm.editMode?t._e():e("button",{staticClass:"btn btn--save-edit",attrs:{type:"button"},on:{click:t.addNewWork}},[t._v("Сохранить")]),t.workForm.editMode?e("button",{staticClass:"btn btn--save-edit",attrs:{type:"button"},on:{click:t.saveEditedWork}},[t._v("Сохранить")]):t._e()])])])])])])};o._withStripped=!0;var i=e(100),s=e(383),a=e(52);function n(t,r,e,o,i,s,a){try{var n=t[s](a),l=n.value}catch(t){return void e(t)}n.done?r(l):Promise.resolve(l).then(o,i)}function l(t){return function(){var r=this,e=arguments;return new Promise(function(o,i){var s=t.apply(r,e);function a(t){n(s,o,i,a,l,"next",t)}function l(t){n(s,o,i,a,l,"throw",t)}a(void 0)})}}function c(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{},o=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.forEach(function(r){d(t,r,e[r])})}return t}function d(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var u={mixins:[e(52).mixin],validators:{renderedPhotoUrl:function(t){return a.Validator.value(t).required("Загрузите картинку")},"work.title":function(t){return a.Validator.value(t).required("Введите название")},"work.link":function(t){return a.Validator.value(t).required("Вставьте ссылку")},"work.description":function(t){return a.Validator.value(t).required("Введите описание")},editedTagsAsString:function(t){return a.Validator.value(t).required("Работа должна содержать по крайней мере один тег")}},components:{formTags:function(){return e.e(20).then(e.bind(null,445))},errorTooltip:function(){return e.e(0).then(e.bind(null,429))}},data:function(){return{renderedPhotoUrl:"",work:{title:"",techs:"",photo:"",link:"",description:""}}},computed:c({},Object(i.e)("works",{workForm:function(t){return t.workForm},editedWork:function(t){return t.editedWork},editedTags:function(t){return t.editedTags}}),{remotePhotoPath:function(){return"".concat(s.a,"/").concat(this.work.photo)},editedTagsAsString:function(){return this.editedTags.join(",")}}),methods:c({},Object(i.b)("works",["addWork","editWork"]),Object(i.d)("works",["CLOSE_FORM","ADD_TAGS"]),Object(i.d)("tooltip",["SHOW_TOOLTIP"]),{appendFileAndRenderPhoto:function(t){var r=this,e=t.target.files[0];this.work.photo=e;var o=new FileReader;try{o.readAsDataURL(e),o.onload=function(){r.renderedPhotoUrl=o.result}}catch(t){console.error(t.message)}},addNewWork:function(){var t=l(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$validate();case 2:if(t.t0=t.sent,!1!==t.t0){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,r=this.createWorkFormData(),t.next=9,this.addWork(r);case 9:this.SHOW_TOOLTIP({type:"success",text:"Работа добавлена"}),this.CLOSE_FORM(),t.next=17;break;case 13:t.prev=13,t.t1=t.catch(5),console.error(t.t1.message),this.SHOW_TOOLTIP({type:"error",text:"Произошла ошибка"});case 17:case"end":return t.stop()}},t,this,[[5,13]])}));return function(){return t.apply(this,arguments)}}(),createWorkFormData:function(){var t=new FormData;return t.append("title",this.work.title),this.workForm.editMode?t.append("techs",this.editedTagsAsString):t.append("techs",this.work.techs),t.append("photo",this.work.photo),t.append("link",this.work.link),t.append("description",this.work.description),t},setEditedWork:function(){this.work=c({},this.editedWork),this.renderedPhotoUrl=this.remotePhotoPath},saveEditedWork:function(){var t=l(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$validate();case 2:if(t.t0=t.sent,!1!==t.t0){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,r={id:this.work.id,data:this.createWorkFormData()},t.next=9,this.editWork(r);case 9:this.SHOW_TOOLTIP({type:"success",text:"Работа обновлена"}),this.CLOSE_FORM(),t.next=17;break;case 13:t.prev=13,t.t1=t.catch(5),console.error(t.t1.message),this.SHOW_TOOLTIP({type:"error",text:"Произошла ошибка"});case 17:case"end":return t.stop()}},t,this,[[5,13]])}));return function(){return t.apply(this,arguments)}}()}),created:function(){this.workForm.editMode&&(this.setEditedWork(),this.work.techs="")}},p=(e(416),e(99)),f=Object(p.a)(u,o,[function(){var t=this.$createElement,r=this._self._c||t;return r("div",{staticClass:"form__upload-photo-content"},[r("span",{staticClass:"form__upload-photo-desc"},[this._v("Перетащите или загрузите для загрузки изображения")]),r("div",{staticClass:"btn btn--upload-work-photo"},[this._v("Загрузить")])])}],!1,null,"73bd2e72",null);f.options.__file="src/admin/components/works/workForm.vue";r.default=f.exports}}]);